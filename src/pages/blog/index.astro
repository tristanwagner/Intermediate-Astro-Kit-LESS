---
import BaseLayout from "src/layouts/BaseLayout.astro";
import CTA from "@components/CTA.astro";
import { getCollection } from "astro:content";
import { formatDate } from "@js/util.js";
import FeaturedPost from "@components/FeaturedPost.astro";
import { getImage } from "astro:assets";
import cabinets from "../../assets/images/cabinets2.jpg";
import "@styles/blog.less";

const posts = await getCollection("blog");
posts.sort(
  (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
);
const authors = await getCollection("authors");
---

<BaseLayout
  title="Blog"
  description="Meta description for the page"
  preloadImgs={[cabinets.src]}
>
  <!-- ============================================ -->
  <!--                    LANDING                   -->
  <!-- ============================================ -->

  <section id="int-hero">
    <h1 id="home-h">Blog</h1>
    <picture>
      <source
        media="(max-width: 600px)"
        srcset="/assets/images/cabinets2-m.jpg"
      />
      <source
        media="(min-width: 601px)"
        srcset="/assets/images/cabinets2.jpg"
      />
      <img
        aria-hidden="true"
        decoding="async"
        alt="kitchen cabinets"
        loading="eager"
        src={cabinets.src}
        width={cabinets.width}
        height={cabinets.height}
      />
    </picture>
  </section>

  <!-- ============================================ -->
  <!--              Main Blog Content               -->
  <!-- ============================================ -->

  <div class="blog-container main-content-wrapper">
    <!--Main content -->
    <div class="main-content">
      <!-- ============================================ -->
      <!--                 Blog Articles                -->
      <!-- ============================================ -->
      {posts.length === 0 && <h1>No Recent Posts</h1>}
      {
        posts.length >= 1 &&
        posts.map((post) => {
            const { title, date, description, image, imageAlt, author: authorRef } = post.data;
            const authorId = authorRef.split("/").pop();
            const author = authors.find(({ id }) => id == authorId)?.data;
            return (
              <article class="recent-articles">
                <picture class="blog-mainImage">
                  <img
                    src={image}
                    alt={imageAlt}
                    width="795"
                    height="400"
                    decoding="async"
                  />
                </picture>

                <div class="article-group">
                  <div class="blog-authorGroup">
                    <picture class="blog-author-img">
                      <img
                        src={author.image}
                        alt="house"
                        width="32"
                        height="32"
                        decoding="async"
                      />
                    </picture>
                    <span class="blog-author">{author.name}</span>
                    <span aria-hidden="true" class="blog-dot" />
                    <span class="blog-date">{formatDate(date)}</span>
                  </div>
                  <h2 class="blog-h1">{title}</h2>
                  <p class="blog-desc">{description}</p>
                  <a href={post.slug} class="blog-link">
                    Continue Reading
                  </a>
                </div>
              </article>
            )
        })
      }
    </div>
    <FeaturedPost />
  </div>
  <CTA />
</BaseLayout>
